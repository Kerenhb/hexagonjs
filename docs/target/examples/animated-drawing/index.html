<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="/resources/quantum-code-highlight.css"></link><style>.drawing-example {
  height: 500px;
  background: #F0F0F0;
}</style><meta name="viewport" content="width=device-width, initial-scale=1"></meta></head>
<body class="qm-body-font"><p>All the drawings have the following styles applied:</p><div class="qm-code-highlight-codeblock language-css"><pre><code class="qm-code-font"><span class="hljs-selector-class">.drawing-example</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#F0F0F0</span>;
}</code></pre></div><br></br><h3>Animated circles</h3><div class="docs-example"><div class="docs-example-body"><div id="animated-circles" class="drawing-example"></div>
<div id="animate-circles" class="hx-btn hx-action">Animate</div>
<div id="reset-circles" class="hx-btn hx-action">Reset</div>drawing = new hx.Drawing('#animated-circles')
drawing.enablePerformanceGauge()
drawing.enableZoom()
drawing.enablePan()

drawing.camera.position.x = drawing.width/2
drawing.camera.position.y = drawing.height/2

circles = (drawing.create('circle') for _ in [0..500])

reset = ->
  for circle, i in circles
    # initial value
    circle.set('position.x', drawing.width/2)
    circle.set('position.y', drawing.height/2)
    circle.set('radius', 2)
    circle.set('fill.color', hx.cycle(hx.theme.plot.colors, i))

animate = ->
  for circle, i in circles
    # animate
    circle.set('position.x', (Math.random() - 0.5) * drawing.width/2 + drawing.width/2 , 100 + Math.random() * 5000)
    circle.set('position.y', (Math.random() - 0.5) * drawing.height/2 + drawing.height/2, 100 + Math.random() * 5000)
    circle.set('radius', 10, 10000)
    circle.set('fill.color', hx.theme.plot.colors[0], 10000)

hx.select('#reset-circles').on 'click', reset
hx.select('#animate-circles').on 'click', animate

reset()
animate()</div><div class="docs-example-code-body"><div class="example-code-section"><h3>HTML</h3><div class="qm-code-highlight-codeblock language-html"><pre><code class="qm-code-font"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"animated-circles"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"drawing-example"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"animate-circles"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hx-btn hx-action"</span>&gt;</span>Animate<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"reset-circles"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hx-btn hx-action"</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div></div><div class="example-code-section"><h3>CoffeeScript</h3><div class="qm-code-highlight-codeblock language-coffee"><pre><code class="qm-code-font">drawing = <span class="hljs-keyword">new</span> hx.Drawing(<span class="hljs-string">'#animated-circles'</span>)
drawing.enablePerformanceGauge()
drawing.enableZoom()
drawing.enablePan()

drawing.camera.position.x = drawing.width/<span class="hljs-number">2</span>
drawing.camera.position.y = drawing.height/<span class="hljs-number">2</span>

circles = (drawing.create(<span class="hljs-string">'circle'</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.500</span>])
<span class="hljs-function">
<span class="hljs-title">reset</span> = -&gt;</span>
  <span class="hljs-keyword">for</span> circle, i <span class="hljs-keyword">in</span> circles
    <span class="hljs-comment"># initial value</span>
    circle.set(<span class="hljs-string">'position.x'</span>, drawing.width/<span class="hljs-number">2</span>)
    circle.set(<span class="hljs-string">'position.y'</span>, drawing.height/<span class="hljs-number">2</span>)
    circle.set(<span class="hljs-string">'radius'</span>, <span class="hljs-number">2</span>)
    circle.set(<span class="hljs-string">'fill.color'</span>, hx.cycle(hx.theme.plot.colors, i))
<span class="hljs-function">
<span class="hljs-title">animate</span> = -&gt;</span>
  <span class="hljs-keyword">for</span> circle, i <span class="hljs-keyword">in</span> circles
    <span class="hljs-comment"># animate</span>
    circle.set(<span class="hljs-string">'position.x'</span>, (Math.random() - <span class="hljs-number">0.5</span>) * drawing.width/<span class="hljs-number">2</span> + drawing.width/<span class="hljs-number">2</span> , <span class="hljs-number">100</span> + Math.random() * <span class="hljs-number">5000</span>)
    circle.set(<span class="hljs-string">'position.y'</span>, (Math.random() - <span class="hljs-number">0.5</span>) * drawing.height/<span class="hljs-number">2</span> + drawing.height/<span class="hljs-number">2</span>, <span class="hljs-number">100</span> + Math.random() * <span class="hljs-number">5000</span>)
    circle.set(<span class="hljs-string">'radius'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10000</span>)
    circle.set(<span class="hljs-string">'fill.color'</span>, hx.theme.plot.colors[<span class="hljs-number">0</span>], <span class="hljs-number">10000</span>)

hx.select(<span class="hljs-string">'#reset-circles'</span>).<span class="hljs-literal">on</span> <span class="hljs-string">'click'</span>, reset
hx.select(<span class="hljs-string">'#animate-circles'</span>).<span class="hljs-literal">on</span> <span class="hljs-string">'click'</span>, animate

reset()
animate()</code></pre></div></div></div></div><br></br><h3>Hexagonal game of life</h3><div class="docs-example"><div class="docs-example-body"><div id="game-of-life" class="drawing-example"></div>
# global variables/constants
speed = 1
size = 32
spacing = 3.4
hexGridWidth = 25
hexGridHeight = 40

# set up the drawing
drawing = new hx.Drawing('#game-of-life')
drawing.enablePan()
drawing.enableZoom()
drawing.enablePerformanceGauge()
drawing.camera.zoomMin = 0.05
drawing.camera.zoomMax = 5
drawing.camera.zoom = 0.3 * drawing.dpr
drawing.camera.position.x = size * (hexGridWidth - 0.5) * spacing / 2
drawing.camera.position.y = size * (hexGridHeight - 0.5) / 2

drawing.enableSidebar 'b', 'tr', (elem) ->
  # set up the slider to control the animation speed
  slider = new hx.Slider(elem)
  slider.render = (slider, elem, value) ->
    hx.select(elem).text((0.1 + value * 9.9).toFixed(1) + ' X')

  slider.value(0)
  speed = 0.1 + slider.value() * 9.9
  slider.on 'change', -> speed = 0.1 + slider.value() * 9.9

# create the grid
hexagonCurve = ([Math.sin((2*i + 1) * Math.PI / 6) * size, Math.cos((2*i + 1) * Math.PI / 6) * size] for i in [0...6])

colors = hx.theme.plot.colors.slice(0).reverse()
colors[1] = '#EEE'

hexGrid =
  for x in [0..hexGridWidth-1]
    for y in [0..hexGridHeight-1]
      hex = drawing.create('shape')
      hex.set('polygon', hexagonCurve)
      hex.set('position.x', size*spacing*x + size*spacing/2 * (y % 2))
      hex.set('position.y', size*1*y)
      hex.set('fill.enabled', true)
      hex.set('fill.color', colors[1])
      object =
        generationsAlive: 0
        drawingObject: hex
        alive: Math.random() > 0.5
        nextAlive: false
      object

# utility methods for the grid
getSurroundingCells = (x, y) ->
  xx = x + (y % 2) - 1
  [
    hexGrid[xx]?[y-1]
    hexGrid[x]?[y-2]
    hexGrid[xx+1]?[y-1]
    hexGrid[xx]?[y+1]
    hexGrid[x]?[y+2]
    hexGrid[xx+1]?[y+1]
  ].filter((d) -> d?)

getSecondarySurroundingCells = (x, y) ->
  xx = x + (y % 2) - 1
  [
    hexGrid[x-1]?[y]
    hexGrid[xx]?[y-3]
    hexGrid[xx]?[y+3]
    hexGrid[xx+1]?[y-3]
    hexGrid[xx+1]?[y+3]
    hexGrid[x+1]?[y]
  ].filter((d) -> d?)

iterateGrid = (f) ->
  for x in [0..hexGridWidth-1]
    for y in [0..hexGridHeight-1]
      f(x, y, hexGrid[x][y])
  undefined

last = (new Date()).getTime()

# main loop
drawing.on 'update', ->

  # control the update rate
  if (new Date()).getTime() - last >= 100/speed
    last = (new Date()).getTime()

    #hexagonal game of life rules: http://www.well.com/~dgb/hexrules.html
    iterateGrid (x, y, cell) ->
      total = 0
      for c in getSurroundingCells(x, y)
        if c.alive then total+=1
      for c in getSecondarySurroundingCells(x, y)
        if c.alive then total+=0.3
      cell.nextAlive = total >= 2.0 && total < 3.3

    # draw
    iterateGrid (x, y, cell) ->
      cell.alive = cell.nextAlive
      cell.generationsAlive = if cell.alive then cell.generationsAlive+1 else 0
      color = colors[Math.min(cell.generationsAlive, 4)+1]
      cell.drawingObject.set('fill.color', color, 250)</div><div class="docs-example-code-body"><div class="example-code-section"><h3>HTML</h3><div class="qm-code-highlight-codeblock language-html"><pre><code class="qm-code-font"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"game-of-life"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"drawing-example"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div></div><div class="example-code-section"><h3>CoffeeScript</h3><div class="qm-code-highlight-codeblock language-coffee"><pre><code class="qm-code-font">
<span class="hljs-comment"># global variables/constants</span>
speed = <span class="hljs-number">1</span>
size = <span class="hljs-number">32</span>
spacing = <span class="hljs-number">3.4</span>
hexGridWidth = <span class="hljs-number">25</span>
hexGridHeight = <span class="hljs-number">40</span>

<span class="hljs-comment"># set up the drawing</span>
drawing = <span class="hljs-keyword">new</span> hx.Drawing(<span class="hljs-string">'#game-of-life'</span>)
drawing.enablePan()
drawing.enableZoom()
drawing.enablePerformanceGauge()
drawing.camera.zoomMin = <span class="hljs-number">0.05</span>
drawing.camera.zoomMax = <span class="hljs-number">5</span>
drawing.camera.zoom = <span class="hljs-number">0.3</span> * drawing.dpr
drawing.camera.position.x = size * (hexGridWidth - <span class="hljs-number">0.5</span>) * spacing / <span class="hljs-number">2</span>
drawing.camera.position.y = size * (hexGridHeight - <span class="hljs-number">0.5</span>) / <span class="hljs-number">2</span>

drawing.enableSidebar <span class="hljs-string">'b'</span>, <span class="hljs-string">'tr'</span>, <span class="hljs-function"><span class="hljs-params">(elem)</span> -&gt;</span>
  <span class="hljs-comment"># set up the slider to control the animation speed</span>
  slider = <span class="hljs-keyword">new</span> hx.Slider(elem)
  slider.render = <span class="hljs-function"><span class="hljs-params">(slider, elem, value)</span> -&gt;</span>
    hx.select(elem).text((<span class="hljs-number">0.1</span> + value * <span class="hljs-number">9.9</span>).toFixed(<span class="hljs-number">1</span>) + <span class="hljs-string">' X'</span>)

  slider.value(<span class="hljs-number">0</span>)
  speed = <span class="hljs-number">0.1</span> + slider.value() * <span class="hljs-number">9.9</span>
  slider.<span class="hljs-literal">on</span> <span class="hljs-string">'change'</span>, <span class="hljs-function">-&gt;</span> speed = <span class="hljs-number">0.1</span> + slider.value() * <span class="hljs-number">9.9</span>

<span class="hljs-comment"># create the grid</span>
hexagonCurve = ([Math.sin((<span class="hljs-number">2</span>*i + <span class="hljs-number">1</span>) * Math.PI / <span class="hljs-number">6</span>) * size, Math.cos((<span class="hljs-number">2</span>*i + <span class="hljs-number">1</span>) * Math.PI / <span class="hljs-number">6</span>) * size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.<span class="hljs-number">.6</span>])

colors = hx.theme.plot.colors.slice(<span class="hljs-number">0</span>).reverse()
colors[<span class="hljs-number">1</span>] = <span class="hljs-string">'#EEE'</span>

hexGrid =
  <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.hexGridWidth<span class="hljs-number">-1</span>]
    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.hexGridHeight<span class="hljs-number">-1</span>]
      hex = drawing.create(<span class="hljs-string">'shape'</span>)
      hex.set(<span class="hljs-string">'polygon'</span>, hexagonCurve)
      hex.set(<span class="hljs-string">'position.x'</span>, size*spacing*x + size*spacing/<span class="hljs-number">2</span> * (y % <span class="hljs-number">2</span>))
      hex.set(<span class="hljs-string">'position.y'</span>, size*<span class="hljs-number">1</span>*y)
      hex.set(<span class="hljs-string">'fill.enabled'</span>, <span class="hljs-literal">true</span>)
      hex.set(<span class="hljs-string">'fill.color'</span>, colors[<span class="hljs-number">1</span>])
      object =
        generationsAlive: <span class="hljs-number">0</span>
        drawingObject: hex
        alive: Math.random() &gt; <span class="hljs-number">0.5</span>
        nextAlive: <span class="hljs-literal">false</span>
      object

<span class="hljs-comment"># utility methods for the grid</span>
<span class="hljs-function"><span class="hljs-title">getSurroundingCells</span> = <span class="hljs-params">(x, y)</span> -&gt;</span>
  xx = x + (y % <span class="hljs-number">2</span>) - <span class="hljs-number">1</span>
  [
    hexGrid[xx]?[y<span class="hljs-number">-1</span>]
    hexGrid[x]?[y<span class="hljs-number">-2</span>]
    hexGrid[xx+<span class="hljs-number">1</span>]?[y<span class="hljs-number">-1</span>]
    hexGrid[xx]?[y+<span class="hljs-number">1</span>]
    hexGrid[x]?[y+<span class="hljs-number">2</span>]
    hexGrid[xx+<span class="hljs-number">1</span>]?[y+<span class="hljs-number">1</span>]
  ].filter(<span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> d?)
<span class="hljs-function">
<span class="hljs-title">getSecondarySurroundingCells</span> = <span class="hljs-params">(x, y)</span> -&gt;</span>
  xx = x + (y % <span class="hljs-number">2</span>) - <span class="hljs-number">1</span>
  [
    hexGrid[x<span class="hljs-number">-1</span>]?[y]
    hexGrid[xx]?[y<span class="hljs-number">-3</span>]
    hexGrid[xx]?[y+<span class="hljs-number">3</span>]
    hexGrid[xx+<span class="hljs-number">1</span>]?[y<span class="hljs-number">-3</span>]
    hexGrid[xx+<span class="hljs-number">1</span>]?[y+<span class="hljs-number">3</span>]
    hexGrid[x+<span class="hljs-number">1</span>]?[y]
  ].filter(<span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> d?)
<span class="hljs-function">
<span class="hljs-title">iterateGrid</span> = <span class="hljs-params">(f)</span> -&gt;</span>
  <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.hexGridWidth<span class="hljs-number">-1</span>]
    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.hexGridHeight<span class="hljs-number">-1</span>]
      f(x, y, hexGrid[x][y])
  <span class="hljs-literal">undefined</span>

last = (<span class="hljs-keyword">new</span> Date()).getTime()

<span class="hljs-comment"># main loop</span>
drawing.<span class="hljs-literal">on</span> <span class="hljs-string">'update'</span>, <span class="hljs-function">-&gt;</span>

  <span class="hljs-comment"># control the update rate</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> Date()).getTime() - last &gt;= <span class="hljs-number">100</span>/speed
    last = (<span class="hljs-keyword">new</span> Date()).getTime()

    <span class="hljs-comment">#hexagonal game of life rules: http://www.well.com/~dgb/hexrules.html</span>
    iterateGrid (x, y, cell) -&gt;
      total = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> getSurroundingCells(x, y)
        <span class="hljs-keyword">if</span> c.alive <span class="hljs-keyword">then</span> total+=<span class="hljs-number">1</span>
      <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> getSecondarySurroundingCells(x, y)
        <span class="hljs-keyword">if</span> c.alive <span class="hljs-keyword">then</span> total+=<span class="hljs-number">0.3</span>
      cell.nextAlive = total &gt;= <span class="hljs-number">2.0</span> &amp;&amp; total &lt; <span class="hljs-number">3.3</span>

    <span class="hljs-comment"># draw</span>
    iterateGrid (x, y, cell) -&gt;
      cell.alive = cell.nextAlive
      cell.generationsAlive = <span class="hljs-keyword">if</span> cell.alive <span class="hljs-keyword">then</span> cell.generationsAlive+<span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
      color = colors[Math.min(cell.generationsAlive, <span class="hljs-number">4</span>)+<span class="hljs-number">1</span>]
      cell.drawingObject.set(<span class="hljs-string">'fill.color'</span>, color, <span class="hljs-number">250</span>)</code></pre></div></div></div></div></body></html>